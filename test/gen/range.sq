-- zero :: { Int | _v == 0 }
-- one :: { Int | _v == 1 }
-- two :: { Int | _v == 2 }
-- three :: { Int | _v == 3 }
-- four :: { Int | _v == 4 }
-- five :: { Int | _v == 5 }
-- six :: { Int | _v == 6 }
-- seven :: { Int | _v == 7 }
-- eight :: { Int | _v == 8 }
-- nine :: { Int | _v == 9 }
ten :: { Int | _v == 10 }
-- eleven :: { Int | _v == 11 }
-- twelve :: { Int | _v == 12 }

neg :: x: Int -> { Int | _v == -x }

data Expr a where
  Eq :: x: a -> Expr a
  Neq :: x: a -> Expr a
  Lt :: x: a -> Expr a
  Gt :: x: a -> Expr a
  And :: lhs: Expr a -> rhs: Expr a -> Expr a
  Or :: lhs: Expr a -> rhs: Expr a -> Expr a

measure eval :: v: a -> Expr a -> Bool where
  Eq x -> v == x
  Neq x -> v != x
  Lt x -> v < x
  Gt x -> v > x
  And lhs rhs -> eval v lhs && eval v rhs
  Or lhs rhs -> eval v lhs || eval v rhs

measure not :: Expr a -> Expr a where
  Eq x -> Neq x
  Neq x -> Eq x
  Lt x -> Or (Gt x) (Eq x)
  Gt x -> Or (Lt x) (Eq x)
  And lhs rhs -> Or (not lhs) (not rhs)
  Or lhs rhs -> And (not lhs) (not rhs)

g :: x: Expr Int -> { Int | eval _v x }
g_not :: x: Expr Int -> { Int | eval _v (not x) && !(eval _v x) }

-- randInt :: Expr Int

range :: x: {Int | _v >= -10 && !(_v < -10) } -> y: { Int | _v >= x } -> z: { Int | _v >= y && _v <= 10 } -> Int
range_x_not ::                     x: {Int | _v >= -10 && !(_v < -10) } -> x_not: { Int | !(_v >= -10 && !(_v < -10)) } -> Int
range_y_not :: x: Int           -> y: { Int | _v >= x }                 -> y_not: { Int | !(_v >= x) } -> Int
range_z_not :: x: Int -> y: Int -> z: { Int | _v >= y && _v <= 10 }     -> z_not: { Int | !(_v >= y && _v <= 10) } -> Int

gen_range :: Int
gen_range =
  let x = (?? :: Expr Int) in
  let x_value = g x in
  let _ = range_x_not x_value (g_not x) in

  let y = (?? :: Expr Int) in
  let y_value = g y in
  let _ = range_y_not x_value y_value (g_not y) in

  let z = (?? :: Expr Int) in
  let z_value = g z in
  let _ = range_z_not x_value y_value z_value (g_not z) in

  range x_value y_value z_value
